<!DOCTYPE html>

<meta charset="utf-8">
<head>    
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="pygment_trac.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="description" content="MSAN 622 Submission Page - Homework 3">
</head>
<style>
    #writeup {
        width: 100%;
    }

    #functionality {
        width: 50%;
        float: left;
        padding: 5px;
        margin-right: 15px;
    }

    #plot {
        margin-left: auto;
        margin-right: auto;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }
    .axis text {
        font: 11px sans-serif;
    }

    .line {
      stroke: black;
      fill: none;
      stroke-width: 1px;
    }

    .line.line0 {
      stroke: #1b9e77;
    }

    .line.line1 {
      stroke: #d95f02;
    }

    .line.line2 {
      stroke: #7570b3;
    }

    .overlay {
      fill: none;
      pointer-events: all;
    }

    .focus circle {
      fill: none;
    }

    .focus circle.y0 {
      stroke: darkgreen;
    }

    .focus circle.y1 {
      stroke: orangered;
    }
    .focus circle.y2 {
      stroke: purple;
    }

    .focus text {
        font: 11px sans-serif;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
    }


    .focus line {
      stroke: purple;
      shape-rendering: crispEdges;
    }

    .focus line.y0 {
      stroke: steelblue;
      stroke-dasharray: 3 3;
      opacity: .5;
    }

    .focus line.y1 {
      stroke: indianred;
      stroke-dasharray: 3 3;
      opacity: .5;
    }
    .focus line.y2 {
      stroke: purple;
      stroke-dasharray: 3 3;
      opacity: .5;
    }
    .brush .extent {
      stroke: #fff;
      fill-opacity: .125;
      shape-rendering: crispEdges;
    }

    .area {
        fill: lightsteelblue;
        stroke-width: 0;
    }

</style>

<h1>Homework 3: Interactive Time Series</h1>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jeff Baker<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<small><a href="https://github.com/jbaker22/jbaker22.github.io/blob/master/spring-2015-msan622/homework3.html">Code on GitHub</a></small>
  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<small><a href="#writeup">Submission details (below)</a></small>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="multiline.js"></script>
<body>
<div id="multiseries"><br><h2>Multi-Series Line Chart</h2>
    <p>Plot of data includes:
        <ul>
          <li>Total drivers</li>
          <li>Front-seat passengers killed or seriously injured</li>
          <li>Car drivers killed</li>
        </ul>
    </p>
</div>
<br>
<div><h2>Area Plot</h2>
    <select id="select-list"></select>
    <div id="areaseries"></div>
</div>
<script>

var margin = {top: 50, right: 20, bottom: 40, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var formatting = d3.format(",.0f");
var color = d3.scale.category10();

// load csv file and call draw functions

    // example data: 
    // "Month",     "DriversKilled",  "drivers",  "front",  "rear", "kms",  "PetrolPrice",    "VanKilled",  "law"
    // "Jan 1969",  107,              1687,       867,      269,    9059,   0.102971811805368,  12,          0
    // "Feb 1969",  97,               1508,       825,      265,    7685,   0.102362995884646,  6,           0
d3.csv("seatbelts.csv", function(error, csv) {
    data = csv;
    // multiline(data);
    areaseries(data);
})


function areaseries(data) {
    // http://bl.ocks.org/mbostock/3883195
    // http://www.delimited.io/blog/2014/3/3/creating-multi-series-charts-in-d3-lines-bars-area-and-streamgraphs
    // http://jsfiddle.net/superboggly/XK53c/

    // console.log(data);
    var margin = {top: 20, right: 20, bottom: 50, left: 50},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var colorfill = d3.scale.category10();

    // DROPDOWN LIST: 
    var select = document.getElementById("select-list");
    optionlist = ["DriversKilled","drivers","front","rear"];
    // populate dropdown list with available years in the data
    o = "";
    for(var i = 0; i < optionlist.length; i++) {
        // get the year for this entry
        // console.log(optionlist[i])
        o = optionlist[i];
        var option = document.createElement('option');    
        option.text = option.value = o;
        select.add(option, 0);

        // switch (optionlist[i]) {
        //     case "DriversKilled": o = "Drivers Killed"; 
        //     case "drivers": o = "Total Drivers"; 
        //     case "front": o =  "Front-Seat Injuries/Casualties"; 
        //     case "rear": o =  "Rear-Seat Injuries/Casualties"; 
        // }
        // console.log(o)
    }

    var parseDate = d3.time.format("%b %Y").parse;

    var x = d3.time.scale()
        .range([0, width]);

    var y = d3.scale.linear()
        .range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left");

    var area = d3.svg.area()
        .x(function(d) { return x(d.date); })
        .y0(height)
        .y1(function(d) { return y(d.drivers); });

    var svg = d3.select("#areaseries").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    data.forEach(function(d) {
        d.date = parseDate(d.Month);
    });

    svg.append("defs").append("clipPath")
        .attr("id", "clip")
        .append("rect")
        .attr("width", width)
        .attr("height", height);

    var main = svg.append("g")
        .attr("class", "focus")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      
    // console.log("data", data)

    // get fields from first data entry pertaining to drivers
    // colorfill.domain(d3.keys(data[0]).filter(function(key) { return (key == "DriversKilled" 
    //   || key == "drivers" || key == "front" || key == "rear"); }));

    // var drivers = stack(colorfill.domain().map(function(name) {
    //     return {
    //         name: name,
    //         values: data.map(function(d) {
    //             return {date: d.date, y: +d[name]};
    //         })
    //     };
    // }));

    // console.log("drivers", drivers);
    x.domain(d3.extent(data.map(function(d) { return d.date; }))).nice();
    y.domain([0, 4000]).nice();

    svg.append("path")
        .datum(data)
        .attr("class", "area")
        .attr("d", area)
        .attr("transform", "translate(1,20)");

    main.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    main.append("g")
        .attr("class", "y axis")
        .call(yAxis);


    // legend color setup
/*
    columns = d3.keys(data[0]).filter(function(key) { return key !== "Month"; })
    // console.log("cols: ",columns)
    color_div = {}
    // assign a color for each state division
    for  (var i = 0; i < 4; i++) {
        color_div[columns[i]] = color(columns[i]);
    };

    var legendSize = 10;  // size of the color boxes
    var legendSpace = 10;  // space between boxes
    var colors = d3.entries(color_div);

    // add legend to the plot
    var legend = svg.selectAll(".legend")
        .data(colors)
        .enter()
        .append("g")
        .attr("class", "legend")
        .attr("transform", function(d, i) {
          return "translate(100," + (i * (legendSize + legendSpace)+60) + ")";
          });

    // add legend color boxes
    legend.append("rect")
      .attr("width", legendSize)
      .attr("height", legendSize)
      .style("fill", function(d) { return d.value; })
      .style("opacity", .8)
      .style("stroke", "#000");

    // add legend text
    legend.append('text')
        .attr('x', legendSize + 4)
        .attr('y', legendSize)
        .text(function(d) { 
          if (d.key == "front"){ return "Front-Seat Injuries/Casualties"; }
          else if (d.key == "rear"){ return "Rear-Seat Injuries/Casualties"; }
          else if (d.key == "DriversKilled"){ return "Drivers Killed"; }
          else { return "Drivers"; }; });
*/

}
</script>

<section id="writeup">
    <h2>Submission Details</h2>
    <section id="functionality">
        <h3>Data Preprocessing</h3>
        <p>The dataset, "<a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/UKDriverDeaths.html" target="_blank">Road Casualties in Great Britain 1969â€“84</a>" was generated in <code>R</code>. While the data includes month/year for each row, that field was lost upon export. The only preprocessing done to the data was adding this "Month" field back in; all remaining data fields are included for this page.</p>
        <h3>Functionality List</h3>
        <p>The following features were implemented in order to reach each corresponding grade level.</p>
        <span id="c-level" style="font-size: 18"><b>Basic Functionality</b></span><br>
            <ul>
              <li>Generated multi-series line plot</li>
              <li>Animated time series bubble plot</li>
            </ul>
        <span id="b-level" style="font-size: 18"><b>Moderate Functionality</b></span><br>
            <ul>
              <li>Panning enabled within "context" plot to shift the window of the larger "detail" view</li>
              <li>Details-on-Demand enabled by hovering over the lines; tooltips show detailed values at each month</li>
            </ul>
        <span id="a-level" style="font-size: 18"><b>Advanced Functionality</b></span><br>
            <ul>
              <li>Brushing enabled on the "context" section of the line chart</li>
            </ul>

    </section>
    <section id="motivation">
      <h3>Interactivity</h3>
        <h4>Multi-line Chart</h4>
        <p>There are two sections to this plot: the large, "focus" area, and the smaller "context" area below that. Users can hover over the focus area to display date and numerical data for any point in time. Highlighting over areas of the context plot will limit that corresponding portion of the data in the focus plot. Once a selection is made, one can pan the window to the left or right, changing the view in the focus plot. Clicking on the context area outside of the selection will reset it. </p>
        <h4>Area Chart</h4>
        <p>For the area chart, my goal was to plot the area and filter by dimension in the data. This was simply to explore using pull-down menus in combination with time series filtering. </p>
        <h3>Motivation</h3>
        <p>For the time series multi-line plot, I chose the template above because of it's multivariate possibilities. Multiple lines were drawn here for different statistics related to drivers. I chose my colors using a <a href="http://colorbrewer2.org/?type=qualitative&scheme=Dark2&n=6">six-class qualitative palette</a>, just to mix it up from the typical red/blue/green.</p>
        <p>For the area plot, I wanted to keep this relatively simple, and focus more on the interactivity. </p>
    </section>
</section>
</body>